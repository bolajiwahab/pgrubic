---
rule: CT003

test_fail_identity_generated_by_default_new_table:
  sql_fail: |
    CREATE TABLE color (
        color_id bigint GENERATED BY DEFAULT AS IDENTITY
    );
  sql_fix: |
    CREATE TABLE color (
        color_id bigint GENERATED ALWAYS AS IDENTITY
    );

test_fail_identity_generated_by_default_existing_table:
  sql_fail: |
    ALTER TABLE color
        ALTER COLUMN color_id ADD GENERATED BY DEFAULT AS IDENTITY;
  sql_fix: |
    ALTER TABLE color
        ALTER COLUMN color_id ADD GENERATED ALWAYS AS IDENTITY;

test_pass_identity_generated_always_new_table:
  sql_pass: |
    CREATE TABLE color (
        color_id bigint GENERATED ALWAYS AS IDENTITY
    );

test_pass_identity_generated_always_existing_table:
  sql_pass: |
    ALTER TABLE color
        ALTER COLUMN color_id ADD GENERATED ALWAYS AS IDENTITY;
