---
formatter: CONSTRAINT

add_primary_key:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT pk_my_table PRIMARY KEY (id, name);
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT pk_my_table
            PRIMARY KEY (id, name);

add_primary_key_using_index:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT orders_pkey PRIMARY KEY USING INDEX idx;
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT orders_pkey
            PRIMARY KEY USING INDEX idx;

add_unique_constraint:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT uk_my_table UNIQUE (id, name)
    INCLUDE (order_date, total_amount) WITH (fillfactor = 70)
    USING INDEX TABLESPACE pg_default;
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT uk_my_table
            UNIQUE (id, name)
            INCLUDE (order_date, total_amount)
            WITH (
                fillfactor = 70
            )
            USING INDEX TABLESPACE pg_default;

add_unique_constraint_using_index:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT orders_pkey UNIQUE USING INDEX idx;
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT orders_pkey
            UNIQUE USING INDEX idx;

add_foreign_key:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT fk_orders_customers
    FOREIGN KEY (customer_id) REFERENCES customers (id)
    DEFERRABLE INITIALLY DEFERRED;
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT fk_orders_customers
            FOREIGN KEY (customer_id) REFERENCES customers (id)
            DEFERRABLE INITIALLY DEFERRED;

add_check_constraint:
  sql: |
    ALTER TABLE orders
    ADD CONSTRAINT check_orders_total
    CHECK (total > 0);
  expected: |
    ALTER TABLE orders
        ADD CONSTRAINT check_orders_total
            CHECK (total > 0);

add_not_null_constraint:
  sql: |
    ALTER TABLE orders
    ALTER COLUMN total SET NOT NULL;
  expected: |
    ALTER TABLE orders
        ALTER COLUMN total SET NOT NULL;
